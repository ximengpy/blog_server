{"remainingRequest":"D:\\study\\project\\blogadmin\\client\\node_modules\\babel-loader\\lib\\index.js!D:\\study\\project\\blogadmin\\server\\db\\article.js","dependencies":[{"path":"D:\\study\\project\\blogadmin\\server\\db\\article.js","mtime":1593942403180},{"path":"D:\\study\\project\\blogadmin\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\study\\project\\blogadmin\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3RvciIpOwoKdmFyIG1vbmdvb3NlID0gcmVxdWlyZSgibW9uZ29vc2UiKTsKCnZhciBhcnRpY2xlSW5mb0RCID0gcmVxdWlyZSgnLi9hcnRpY2xlSW5mbycpOwoKdmFyIFNjaGVtYSA9IG1vbmdvb3NlLlNjaGVtYTsKdmFyIGFydGljbGVTY2hlbWEgPSBuZXcgU2NoZW1hKHsKICB0eXBlOiB7CiAgICB0eXBlOiBTdHJpbmcsCiAgICByZXF1aXJlZDogdHJ1ZQogIH0sCiAgdGl0bGU6IHsKICAgIHR5cGU6IFN0cmluZywKICAgIHJlcXVpcmVkOiB0cnVlCiAgfSwKICBjb250ZW50OiB7CiAgICB0eXBlOiBTdHJpbmcsCiAgICByZXF1aXJlZDogdHJ1ZQogIH0sCiAgdGFnOiB7CiAgICB0eXBlOiBTdHJpbmcsCiAgICByZXF1aXJlZDogdHJ1ZQogIH0sCiAgZGF0ZTogewogICAgdHlwZTogRGF0ZSwKICAgIGRlZmF1bHQ6IERhdGUubm93CiAgfSwKICB1cGRhdGVEYXRlOiB7CiAgICB0eXBlOiBEYXRlLAogICAgZGVmYXVsdDogRGF0ZS5ub3cKICB9LAogIHN1cmZhY2U6IHsKICAgIHR5cGU6IFN0cmluZywKICAgIGRlZmF1bHQ6ICdodHRwOi8vbG9jYWxob3N0OjMwMDAvaW1nL2RlZmF1bHRTdXJmYWNlLmpwZycKICB9LAogIHB2OiB7CiAgICB0eXBlOiBOdW1iZXIsCiAgICBkZWZhdWx0OiAwCiAgfSwKICBjb21tZW50OiBbewogICAgdHlwZTogU2NoZW1hLlR5cGVzLk9iamVjdElELAogICAgcmVmOiAiY29tbWVudCIKICB9XQp9KTsKYXJ0aWNsZVNjaGVtYS5wcmUoInVwZGF0ZSIsIGZ1bmN0aW9uIChuZXh0KSB7CiAgdGhpcy51cGRhdGUgPSBub3cuRGF0ZTsKICBuZXh0KCk7Cn0pOyAvL+ebkeWQrOa3u+WKoOaWh+eroAoKYXJ0aWNsZVNjaGVtYS5wcmUoInNhdmUiLCBmdW5jdGlvbiAobmV4dCkgewogIC8v5L+d5a2Y55qE5pe25YCZ77yM5pu05pawYXJ0aWNsZUluZm/ooagKICBhcnRpY2xlSW5mb0RCLmZpbmRPbmUoe30pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsKICAgIGNvbnNvbGUubG9nKGRhdGEpOwoKICAgIGlmIChkYXRhKSB7CiAgICAgIC8v5aaC5p6c5bey57uP5a2Y5Zyo5LqGZGF0YSDmm7TmlrBudW0KICAgICAgYXJ0aWNsZUluZm9EQi51cGRhdGUoe30sIHsKICAgICAgICAkaW5jOiB7CiAgICAgICAgICBudW06IDEKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGQpIHt9KS5jYXRjaChmdW5jdGlvbiAoZSkge30pOwogICAgfSBlbHNlIHsKICAgICAgLy/lpoLmnpzov5jmsqHmnInmlbDmja7vvIzlsLHmlrDlu7rkuIDmnaEKICAgICAgYXJ0aWNsZUluZm9EQi5jcmVhdGUoewogICAgICAgIG51bTogMQogICAgICB9KTsKICAgIH0KICB9KTsKICBuZXh0KCk7Cn0pOwp2YXIgYXJ0aWNsZSA9IG1vbmdvb3NlLm1vZGVsKCJhcnRpY2xlIiwgYXJ0aWNsZVNjaGVtYSk7Cm1vZHVsZS5leHBvcnRzID0gYXJ0aWNsZTs="},{"version":3,"sources":["D:/study/project/blogadmin/server/db/article.js"],"names":["mongoose","require","articleInfoDB","Schema","articleSchema","type","String","required","title","content","tag","date","Date","default","now","updateDate","surface","pv","Number","comment","Types","ObjectID","ref","pre","next","update","findOne","then","data","console","log","$inc","num","d","catch","e","create","article","model","module","exports"],"mappings":";;AAAA,IAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAxB;;AACA,IAAMC,aAAa,GAAGD,OAAO,CAAC,eAAD,CAA7B;;AACA,IAAIE,MAAM,GAAGH,QAAQ,CAACG,MAAtB;AACA,IAAIC,aAAa,GAAG,IAAID,MAAJ,CAAW;AAC7BE,EAAAA,IAAI,EAAG;AAACA,IAAAA,IAAI,EAAEC,MAAP;AAAcC,IAAAA,QAAQ,EAAE;AAAxB,GADsB;AAE7BC,EAAAA,KAAK,EAAG;AAACH,IAAAA,IAAI,EAAEC,MAAP;AAAcC,IAAAA,QAAQ,EAAE;AAAxB,GAFqB;AAG7BE,EAAAA,OAAO,EAAG;AAACJ,IAAAA,IAAI,EAACC,MAAN;AAAaC,IAAAA,QAAQ,EAAE;AAAvB,GAHmB;AAI7BG,EAAAA,GAAG,EAAG;AAACL,IAAAA,IAAI,EAAEC,MAAP;AAAcC,IAAAA,QAAQ,EAAE;AAAxB,GAJuB;AAK7BI,EAAAA,IAAI,EAAG;AAACN,IAAAA,IAAI,EAAEO,IAAP;AAAaC,IAAAA,OAAO,EAAED,IAAI,CAACE;AAA3B,GALsB;AAM7BC,EAAAA,UAAU,EAAE;AAACV,IAAAA,IAAI,EAAEO,IAAP;AAAaC,IAAAA,OAAO,EAAED,IAAI,CAACE;AAA3B,GANiB;AAO7BE,EAAAA,OAAO,EAAG;AAACX,IAAAA,IAAI,EAACC,MAAN;AAAaO,IAAAA,OAAO,EAAE;AAAtB,GAPmB;AAQ7BI,EAAAA,EAAE,EAAG;AAACZ,IAAAA,IAAI,EAAEa,MAAP;AAAcL,IAAAA,OAAO,EAAE;AAAvB,GARwB;AAS7BM,EAAAA,OAAO,EAAG,CAAC;AAACd,IAAAA,IAAI,EAACF,MAAM,CAACiB,KAAP,CAAaC,QAAnB;AAA4BC,IAAAA,GAAG,EAAC;AAAhC,GAAD;AATmB,CAAX,CAApB;AAYAlB,aAAa,CAACmB,GAAd,CAAkB,QAAlB,EAA4B,UAASC,IAAT,EAAe;AACzC,OAAKC,MAAL,GAAcX,GAAG,CAACF,IAAlB;AACAY,EAAAA,IAAI;AACL,CAHD,E,CAMA;;AACApB,aAAa,CAACmB,GAAd,CAAkB,MAAlB,EAAyB,UAASC,IAAT,EAAc;AACrC;AACAtB,EAAAA,aAAa,CAACwB,OAAd,CAAsB,EAAtB,EACGC,IADH,CACQ,UAAAC,IAAI,EAAE;AACVC,IAAAA,OAAO,CAACC,GAAR,CAAYF,IAAZ;;AACA,QAAIA,IAAJ,EAAS;AACP;AACA1B,MAAAA,aAAa,CACVuB,MADH,CACU,EADV,EACa;AAACM,QAAAA,IAAI,EAAC;AAACC,UAAAA,GAAG,EAAC;AAAL;AAAN,OADb,EAEGL,IAFH,CAEQ,UAAAM,CAAC,EAAE,CAAE,CAFb,EAEeC,KAFf,CAEqB,UAAAC,CAAC,EAAE,CAAE,CAF1B;AAGD,KALD,MAKK;AACH;AACAjC,MAAAA,aAAa,CAACkC,MAAd,CAAqB;AACnBJ,QAAAA,GAAG,EAAG;AADa,OAArB;AAGD;AACF,GAdH;AAeAR,EAAAA,IAAI;AACL,CAlBD;AAmBA,IAAIa,OAAO,GAAGrC,QAAQ,CAACsC,KAAT,CAAe,SAAf,EAA0BlC,aAA1B,CAAd;AAIAmC,MAAM,CAACC,OAAP,GAAiBH,OAAjB","sourcesContent":["const mongoose = require(\"mongoose\");\r\nconst articleInfoDB = require('./articleInfo')\r\nlet Schema = mongoose.Schema;\r\nlet articleSchema = new Schema({\r\n  type : {type: String,required: true},\r\n  title : {type: String,required: true},\r\n  content : {type:String,required: true},\r\n  tag : {type: String,required: true},\r\n  date : {type: Date, default: Date.now},\r\n  updateDate: {type: Date, default: Date.now},\r\n  surface : {type:String,default: 'http://localhost:3000/img/defaultSurface.jpg'},\r\n  pv : {type: Number,default: 0},\r\n  comment : [{type:Schema.Types.ObjectID,ref:\"comment\"}]\r\n})\r\n\r\narticleSchema.pre(\"update\", function(next) {\r\n  this.update = now.Date\r\n  next()\r\n})\r\n\r\n\r\n//监听添加文章\r\narticleSchema.pre(\"save\",function(next){\r\n  //保存的时候，更新articleInfo表\r\n  articleInfoDB.findOne({})\r\n    .then(data=>{\r\n      console.log(data)\r\n      if (data){\r\n        //如果已经存在了data 更新num\r\n        articleInfoDB\r\n          .update({},{$inc:{num:1}})\r\n          .then(d=>{}).catch(e=>{})\r\n      }else{\r\n        //如果还没有数据，就新建一条\r\n        articleInfoDB.create({\r\n          num : 1\r\n        });\r\n      }\r\n    })\r\n  next();\r\n});\r\nlet article = mongoose.model(\"article\", articleSchema);\r\n\r\n\r\n\r\nmodule.exports = article;\r\n"]}]}